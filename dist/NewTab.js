import{u as O,C as T,j as e,r as d,A as j,E as S,e as F,c as K,a as M,d as q,R as I,U as H,b as Y,s as J,l as C,D as P,f as U,S as _,v as W,g as z,h as $,i as V,k as Q,m as X,n as Z,o as ee,p as oe,q as te,P as ne,t as ae,w as re}from"./AppContext.js";function A({id:t,children:s}){const{attributes:u,listeners:i,setNodeRef:k,transform:c,transition:r,isDragging:f}=O({id:t}),x={transform:T.Transform.toString(c),transition:r,zIndex:f?999:void 0};return e.jsx("div",{ref:k,style:x,...u,...i,children:s})}const w="Enter group name";function se(t){const{bookmarkGroups:s,setBookmarkGroups:u}=d.useContext(j),{bookmarkGroup:i,groupIndex:k}=t,c=i&&i.groupName&&i.groupName!==S,[r,f]=d.useState(!1),[x,b]=d.useState(!c),g=d.useRef(null);d.useEffect(()=>{r&&g.current&&g.current.focus()},[r]);async function p(n){f(!1);const E=n.target.textContent.trim();E===""?(g.current.textContent=c?i.groupName:w,i.groupName=S,b(!c)):(b(!1),await F(k,E,u))}function o(n){n.key==="Enter"?(n.preventDefault(),n.target.blur()):n.key==="Escape"&&(n.target.textContent=c?i.groupName:w,b(!c),f(!1))}function a(n){b(n.target.textContent.trim()==="")}const l=()=>{g.current&&x&&(g.current.textContent=""),f(!0)};return e.jsx("h2",{ref:g,contentEditable:r,onBlur:p,onKeyDown:r?o:void 0,onInput:r?a:void 0,onClick:l,onPointerDown:n=>n.stopPropagation(),className:`editable-heading ${x?"placeholder-text":""}`,suppressContentEditableWarning:!0,children:c?i.groupName:w})}function ie(t){const{bookmarkGroups:s,setBookmarkGroups:u}=d.useContext(j),[i,k]=d.useState(t.bookmark.name),[c,r]=d.useState(t.bookmark.url),f=p=>`https://www.google.com/s2/favicons?sz=16&domain=${p}`;function x(p,o,a,l){let n=l.current;n.setAttribute("contenteditable","true"),n.focus();const E=window.getSelection(),m=document.createRange();m.selectNodeContents(n),E.removeAllRanges(),E.addRange(m),n.addEventListener("keydown",function(N){N.key==="Enter"&&(N.preventDefault(),n.blur())}),n.addEventListener("blur",async N=>{const h=N.target.textContent.trim();k(h),await M(o,a,h,u),n.setAttribute("contenteditable","false")})}async function b(p,o,a){const l=s[o],n=l.bookmarks[a];window.confirm("Are you sure you want to delete the "+n.name+" bookmark from "+l.groupName+"?")&&await q(a,o,u)}const g=d.useRef(null);return e.jsxs("div",{className:"bookmark-container",children:[e.jsx("img",{className:"favicon",src:f(t.bookmark.url),alt:""}),e.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",ref:g,children:i}),e.jsx(L,{imagePath:"assets/edit-icon.svg",onClick:p=>x(p,t.groupIndex,t.bookmarkIndex,g)}),e.jsx(L,{imagePath:"assets/delete-icon.svg",onClick:p=>b(p,t.groupIndex,t.bookmarkIndex)})]},K())}function L(t){return e.jsx("button",{className:"modify-link-button",onClick:t.onClick,children:e.jsx("img",{src:t.imagePath,className:"modify-link-button-img"})})}function ce(t){const{bookmarkGroups:s,setBookmarkGroups:u}=d.useContext(j),[i,k]=d.useState(!1),c=s[t.groupIndex].groupName;function r(f){k(!0)}return e.jsx("div",{className:"add-link-inline-container",children:i?e.jsx(de,{groupName:c,setLinkBeingEdited:k}):e.jsx(le,{onClick:r})})}function le(t){return e.jsx("div",{children:e.jsx("button",{className:"add-bookmark-button-1",onClick:t.onClick,children:"+ Add Link"})})}function de(t){const{bookmarkGroups:s,setBookmarkGroups:u}=d.useContext(j),[i,k]=I.useState(""),[c,r]=I.useState("");function f(o){k(o.target.value)}function x(o){r(o.target.value)}function b(o){o.key==="Enter"&&(o.preventDefault(),g(o))}async function g(o){o.preventDefault();const a=Y(c);console.log("props.groupName: ",t.groupName),J(i,a,t.groupName,u),u(await C()),k(""),r("")}function p(o){t.setLinkBeingEdited(!1)}return e.jsxs("div",{className:"create-new-bookmark-component",children:[e.jsx("div",{className:"form-container",children:e.jsxs("form",{onKeyDown:b,children:[e.jsx("input",{type:"text",placeholder:"Enter a bookmark name ...",autoFocus:!0,value:i,onChange:f,required:!0}),e.jsx("input",{type:"text",placeholder:"Enter a bookmark URL ...",value:c,onChange:x,pattern:H,required:!0})]})}),e.jsx("button",{type:"submit",className:"add-bookmark-button-2",onClick:g,children:"Add Bookmark"}),e.jsx("button",{className:"close-form-button",onClick:o=>p(),children:e.jsx("img",{src:"./assets/delete-icon.svg"})})]})}class ue extends I.Component{render(){const{bookmarkGroup:s,groupIndex:u,sensors:i,handleDragEnd:k,handleDeleteBookmarkGroup:c}=this.props;return e.jsx(A,{id:s.id,children:e.jsxs("div",{className:"bookmark-group-box",children:[e.jsx("button",{className:"delete-bookmark-group-button",onClick:r=>c(r,u),children:e.jsx("img",{src:"./assets/delete-icon.svg",alt:"Delete Group"})}),e.jsx(se,{bookmarkGroup:s,groupIndex:u},"heading-"+s.id),e.jsx(P,{sensors:i,collisionDetection:U,onDragEnd:k,children:e.jsx(_,{items:s.bookmarks.map(r=>r.id),strategy:W,children:s.bookmarks.map((r,f)=>e.jsx(A,{id:r.id,children:e.jsx(ie,{bookmark:r,bookmarkIndex:f,groupIndex:u},r.id)},r.id))})}),e.jsx(ce,{groupIndex:u})]})},s.id)}}const R={ADD_EMPTY_GROUP:"add_empty_group",DELETE_GROUP:"delete_group",NONE:"none"};function ke(){const{bookmarkGroups:t,setBookmarkGroups:s}=d.useContext(j),[u,i]=d.useState(!0),k=d.useRef(null),c=V(Q(ne,{activationConstraint:{distance:8}})),r=d.useRef(R.NONE);d.useEffect(()=>{C().then(o=>{s(o),i(!1)})},[]),d.useEffect(()=>{if(u)return;t.some(a=>a.groupName===S&&a.bookmarks.length==0)||X(s)},[t,u]);async function f(o,a){window.confirm("Are you sure you want to delete the entire group "+t[a].groupName+"?")&&(r.current=R.DELETE_GROUP,await ae(a,s))}async function x(o){const{active:a,over:l}=o;if(!l||a.id===l.id)return;const n=t.find(m=>m.id===a.id),E=t.find(m=>m.id===l.id);if(n&&E){const m=t.findIndex(h=>h.id===a.id),N=t.findIndex(h=>h.id===l.id);oe(m,N,s)}else{let m=-1,N=-1,h=-1,y=-1;t.forEach((v,G)=>{const B=v.bookmarks.findIndex(D=>D.id===a.id);B!==-1&&(m=G,N=B)}),t.forEach((v,G)=>{const B=v.bookmarks.findIndex(D=>D.id===l.id);B!==-1&&(h=G,y=B)}),m!==-1&&N!==-1&&h!==-1&&y!==-1&&m===h&&te(N,y,m,h,s)}}async function b(){let o=await C();const a=JSON.stringify(o),l=new Blob([a],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(l),n.download="bookmarks.json",n.click()}async function g(o){const a=o.target.files[0],l=new FileReader;l.onload=async function(n){const E=n.target.result,m=JSON.parse(E);await re(m,s),console.log("Bookmarks saved to local storage:",m)},l.readAsText(a)}function p(){const o=document.createElement("input");o.type="file",o.addEventListener("change",g),o.click()}return d.useEffect(()=>{function o(a,l){console.log("Handling storage change"),l==="local"&&a[ee]&&C().then(s)}return chrome.storage.onChanged.addListener(o),()=>chrome.storage.onChanged.removeListener(o)},[]),d.useEffect(()=>{k.current&&r.current==R.ADD_EMPTY_GROUP&&k.current.querySelector(".editable-heading").focus()},[t]),e.jsxs("div",{children:[e.jsxs("div",{className:"export-bookmarks-button-container",children:[e.jsx("button",{className:"export-or-load-bookmarks-button",onClick:b,children:"Export Bookmarks"}),e.jsx("button",{className:"export-or-load-bookmarks-button",onClick:p,children:"Load Bookmarks"})]}),e.jsx(P,{sensors:c,collisionDetection:U,onDragEnd:x,children:e.jsx(_,{items:t.map(o=>o.id),strategy:Z,children:e.jsx("div",{className:"bookmark-groups-container",children:t.map((o,a)=>e.jsx(ue,{bookmarkGroup:o,groupIndex:a,sensors:c,handleDragEnd:x,handleDeleteBookmarkGroup:f},o.id))})})})]})}z.render(e.jsx($,{children:e.jsx(ke,{})}),document.getElementById("root"));
