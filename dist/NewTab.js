import{r as l,A as B,j as e,c as I,e as U,d as P,a as O,R as D,U as _,b as T,s as F,l as w,f as K,g as q,u as M,h as H,D as R,i as S,S as G,k as J,v as Y,m as z,n as W,o as V,P as $,p as Q,C as X,q as Z,t as ee}from"./AppContext.js";function oe(t){const{bookmarkGroups:k,setBookmarkGroups:f}=l.useContext(B),[d,i]=l.useState(t.bookmark.name),[m,u]=l.useState(t.bookmark.url),x=a=>`https://www.google.com/s2/favicons?sz=16&domain=${a}`;function h(a,o,c,p){let r=p.current;r.setAttribute("contenteditable","true"),r.focus();const b=window.getSelection(),g=document.createRange();g.selectNodeContents(r),b.removeAllRanges(),b.addRange(g),r.addEventListener("keydown",function(N){N.key==="Enter"&&(N.preventDefault(),r.blur())}),r.addEventListener("blur",async N=>{const j=N.target.textContent.trim();i(j),await U(o,c,j,f),r.setAttribute("contenteditable","false")})}async function s(a,o,c){const p=k[o],r=p.bookmarks[c];window.confirm("Are you sure you want to delete the "+r.name+" bookmark from "+p.groupName+"?")&&await P(c,o,f)}const n=l.useRef(null);return e.jsxs("div",{className:"bookmark-container",children:[e.jsx("img",{className:"favicon",src:x(t.bookmark.url),alt:""}),e.jsx("a",{href:m,target:"_blank",rel:"noopener noreferrer",ref:n,children:d}),e.jsx(A,{imagePath:"assets/edit-icon.svg",onClick:a=>h(a,t.groupIndex,t.bookmarkIndex,n)}),e.jsx(A,{imagePath:"assets/delete-icon.svg",onClick:a=>s(a,t.groupIndex,t.bookmarkIndex)})]},I())}function A(t){return e.jsx("button",{className:"modify-link-button",onClick:t.onClick,children:e.jsx("img",{src:t.imagePath,className:"modify-link-button-img"})})}function te(t){const{bookmarkGroups:k,setBookmarkGroups:f}=l.useContext(B),d=k[t.groupIndex],[i,m]=l.useState(!1),u=l.useRef(null);l.useEffect(()=>{if(i&&u.current){u.current.focus();const s=window.getSelection(),n=document.createRange();n.selectNodeContents(u.current),s.removeAllRanges(),s.addRange(n)}},[i]);async function x(s){m(!1);const n=s.target.textContent.trim();n?await O(t.groupIndex,n,f):s.target.textContent=d.groupName}function h(s){s.key==="Enter"?(s.preventDefault(),s.target.blur()):s.key==="Escape"&&(s.target.textContent=d.groupName,m(!1))}return e.jsx("h2",{ref:u,contentEditable:i,onBlur:x,onKeyDown:i?h:void 0,onClick:()=>m(!0),onPointerDown:s=>s.stopPropagation(),className:"editable-heading",suppressContentEditableWarning:!0,children:d.groupName})}function ne(t){const{bookmarkGroups:k,setBookmarkGroups:f}=l.useContext(B),[d,i]=l.useState(!1),m=k[t.groupIndex].groupName;function u(x){i(!0)}return e.jsx("div",{className:"add-link-inline-container",children:d?e.jsx(re,{groupName:m,setLinkBeingEdited:i}):e.jsx(ae,{onClick:u})})}function ae(t){return e.jsx("div",{children:e.jsx("button",{className:"add-bookmark-button-1",onClick:t.onClick,children:"+ Add Link"})})}function re(t){const{bookmarkGroups:k,setBookmarkGroups:f}=l.useContext(B),[d,i]=D.useState(""),[m,u]=D.useState("");function x(o){i(o.target.value)}function h(o){u(o.target.value)}function s(o){o.key==="Enter"&&(o.preventDefault(),n(o))}async function n(o){o.preventDefault();const c=T(m);console.log("props.groupName: ",t.groupName),F(d,c,t.groupName,f),f(await w()),i(""),u("")}function a(o){t.setLinkBeingEdited(!1)}return e.jsxs("div",{className:"create-new-bookmark-component",children:[e.jsx("div",{className:"form-container",children:e.jsxs("form",{onKeyDown:s,children:[e.jsx("input",{type:"text",placeholder:"Enter a bookmark name ...",autoFocus:!0,value:d,onChange:x,required:!0}),e.jsx("input",{type:"text",placeholder:"Enter a bookmark URL ...",value:m,onChange:h,pattern:_,required:!0})]})}),e.jsx("button",{type:"submit",className:"add-bookmark-button-2",onClick:n,children:"Add Bookmark"}),e.jsx("button",{className:"close-form-button",onClick:o=>a(),children:e.jsx("img",{src:"./assets/delete-icon.svg"})})]})}function L({id:t,children:k}){const{attributes:f,listeners:d,setNodeRef:i,transform:m,transition:u,isDragging:x}=Q({id:t}),h={transform:X.Transform.toString(m),transition:u,zIndex:x?999:void 0};return e.jsx("div",{ref:i,style:h,...f,...d,children:k})}const y={ADD_EMPTY_GROUP:"add_empty_group",DELETE_GROUP:"delete_group",NONE:"none"};function se(){const{bookmarkGroups:t,setBookmarkGroups:k}=l.useContext(B),f=l.useRef(null),d=M(H($,{activationConstraint:{distance:8}})),i=l.useRef(y.NONE);async function m(n,a){window.confirm("Are you sure you want to delete the entire group "+t[a].groupName+"?")&&(i.current=y.DELETE_GROUP,await Z(a,k))}async function u(n){const{active:a,over:o}=n;if(!o||a.id===o.id)return;const c=t.find(r=>r.id===a.id),p=t.find(r=>r.id===o.id);if(c&&p){const r=t.findIndex(g=>g.id===a.id),b=t.findIndex(g=>g.id===o.id);W(r,b,k)}else{let r=-1,b=-1,g=-1,N=-1;t.forEach((j,v)=>{const E=j.bookmarks.findIndex(C=>C.id===a.id);E!==-1&&(r=v,b=E)}),t.forEach((j,v)=>{const E=j.bookmarks.findIndex(C=>C.id===o.id);E!==-1&&(g=v,N=E)}),r!==-1&&b!==-1&&g!==-1&&N!==-1&&r===g&&V(b,N,r,g,k)}}async function x(){let n=await w();const a=JSON.stringify(n),o=new Blob([a],{type:"application/json"}),c=document.createElement("a");c.href=URL.createObjectURL(o),c.download="bookmarks.json",c.click()}async function h(n){const a=n.target.files[0],o=new FileReader;o.onload=async function(c){const p=c.target.result,r=JSON.parse(p);await ee(r,k),console.log("Bookmarks saved to local storage:",r)},o.readAsText(a)}function s(){const n=document.createElement("input");n.type="file",n.addEventListener("change",h),n.click()}return l.useEffect(()=>{function n(a,o){console.log("Handling storage change"),o==="local"&&a[z]&&w().then(k)}return chrome.storage.onChanged.addListener(n),()=>chrome.storage.onChanged.removeListener(n)},[]),l.useEffect(()=>{f.current&&i.current==y.ADD_EMPTY_GROUP&&f.current.querySelector(".editable-heading").focus()},[t]),e.jsxs("div",{children:[e.jsxs("div",{className:"export-bookmarks-button-container",children:[e.jsx("button",{className:"export-or-load-bookmarks-button",onClick:x,children:"Export Bookmarks"}),e.jsx("button",{className:"export-or-load-bookmarks-button",onClick:s,children:"Load Bookmarks"})]}),e.jsx(R,{sensors:d,collisionDetection:S,onDragEnd:u,children:e.jsx(G,{items:t.map(n=>n.id),strategy:J,children:e.jsx("div",{className:"bookmark-groups-container",children:t.map((n,a)=>e.jsx(L,{id:n.id,children:e.jsxs("div",{className:"bookmark-group-box",children:[e.jsx("button",{className:"delete-bookmark-group-button",onClick:o=>m(o,a),children:e.jsx("img",{src:"./assets/delete-icon.svg"})}),e.jsx(te,{bookmarkGroup:n,groupIndex:a},"heading-"+n.id),e.jsx(R,{sensors:d,collisionDetection:S,onDragEnd:u,children:e.jsx(G,{items:n.bookmarks.map(o=>o.id),strategy:Y,children:n.bookmarks.map((o,c)=>e.jsx(L,{id:o.id,children:e.jsx(oe,{bookmark:o,bookmarkIndex:c,groupIndex:a},o.id)},o.id))})}),e.jsx(ne,{groupIndex:a})]})},n.id))})})})]})}K.render(e.jsx(q,{children:e.jsx(se,{})}),document.getElementById("root"));
