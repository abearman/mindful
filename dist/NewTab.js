import{u as O,C as T,j as e,r as u,A as B,E as C,e as F,c as M,a as K,d as q,R as I,U as H,b as Y,s as J,l as v,D as P,f as U,S as _,v as W,g as z,h as $,i as V,k as Q,m as X,n as Z,o as ee,p as oe,q as te,P as ne,t as ae,w as se}from"./AppContext.js";function L({id:t,children:s}){const{attributes:i,listeners:c,setNodeRef:k,transform:l,transition:m,isDragging:r}=O({id:t}),p={transform:T.Transform.toString(l),transition:m,zIndex:r?999:void 0};return e.jsx("div",{ref:k,style:p,...i,...c,children:s})}const R="+ Add a group";function re(t){const{bookmarkGroups:s,setBookmarkGroups:i}=u.useContext(B),{bookmarkGroup:c,groupIndex:k}=t,l=c&&c.groupName&&c.groupName!==C,[m,r]=u.useState(!1),[p,b]=u.useState(!l),g=u.useRef(null);u.useEffect(()=>{m&&g.current&&g.current.focus()},[m]);async function x(n){r(!1);const N=n.target.textContent.trim();N===""?(g.current.textContent=l?c.groupName:R,c.groupName=C,b(!l)):(b(!1),await F(k,N,i))}function o(n){n.key==="Enter"?(n.preventDefault(),n.target.blur()):n.key==="Escape"&&(n.target.textContent=l?c.groupName:R,b(!l),r(!1))}function a(n){b(n.target.textContent.trim()==="")}const d=()=>{g.current&&p&&(g.current.textContent=""),r(!0)};return e.jsx("h2",{ref:g,contentEditable:m,onBlur:x,onKeyDown:m?o:void 0,onInput:m?a:void 0,onClick:d,onPointerDown:n=>n.stopPropagation(),className:`editable-heading ${p?"placeholder-text":""}`,suppressContentEditableWarning:!0,children:l?c.groupName:R})}function ie(t){const{bookmarkGroups:s,setBookmarkGroups:i}=u.useContext(B),[c,k]=u.useState(t.bookmark.name),[l,m]=u.useState(t.bookmark.url),r=x=>`https://www.google.com/s2/favicons?sz=16&domain=${x}`;function p(x,o,a,d){let n=d.current;n.setAttribute("contenteditable","true"),n.focus();const N=window.getSelection(),f=document.createRange();f.selectNodeContents(n),N.removeAllRanges(),N.addRange(f),n.addEventListener("keydown",function(E){E.key==="Enter"&&(E.preventDefault(),n.blur())}),n.addEventListener("blur",async E=>{const h=E.target.textContent.trim();k(h),await K(o,a,h,i),n.setAttribute("contenteditable","false")})}async function b(x,o,a){const d=s[o],n=d.bookmarks[a];window.confirm("Are you sure you want to delete the "+n.name+" bookmark from "+d.groupName+"?")&&await q(a,o,i)}const g=u.useRef(null);return e.jsxs("div",{className:"bookmark-container",children:[e.jsx("img",{className:"favicon",src:r(t.bookmark.url),alt:""}),e.jsx("a",{href:l,target:"_blank",rel:"noopener noreferrer",ref:g,children:c}),e.jsx(A,{imagePath:"assets/edit-icon.svg",onClick:x=>p(x,t.groupIndex,t.bookmarkIndex,g)}),e.jsx(A,{imagePath:"assets/delete-icon.svg",onClick:x=>b(x,t.groupIndex,t.bookmarkIndex)})]},M())}function A(t){return e.jsx("button",{className:"modify-link-button",onClick:t.onClick,children:e.jsx("img",{src:t.imagePath,className:"modify-link-button-img"})})}function ce(t){const{bookmarkGroups:s,setBookmarkGroups:i}=u.useContext(B),[c,k]=u.useState(!1),l=s[t.groupIndex].groupName;function m(r){k(!0)}return e.jsx("div",{className:"add-link-inline-container",children:c?e.jsx(de,{groupName:l,setLinkBeingEdited:k}):e.jsx(le,{onClick:m})})}function le(t){return e.jsx("div",{children:e.jsx("button",{className:"add-bookmark-button-1",onClick:t.onClick,children:"+ Add a link"})})}function de(t){const{bookmarkGroups:s,setBookmarkGroups:i}=u.useContext(B),[c,k]=I.useState(""),[l,m]=I.useState("");function r(o){k(o.target.value)}function p(o){m(o.target.value)}function b(o){o.key==="Enter"&&(o.preventDefault(),g(o))}async function g(o){o.preventDefault();const a=Y(l);console.log("props.groupName: ",t.groupName),J(c,a,t.groupName,i),i(await v()),k(""),m(""),t.setLinkBeingEdited(!1)}function x(o){t.setLinkBeingEdited(!1)}return e.jsxs("div",{className:"create-new-bookmark-component",children:[e.jsx("div",{className:"form-container",children:e.jsxs("form",{onKeyDown:b,children:[e.jsx("input",{type:"text",placeholder:"Enter a link name",autoFocus:!0,value:c,onChange:r,required:!0}),e.jsx("input",{type:"text",placeholder:"Enter a link URL",value:l,onChange:p,pattern:H,required:!0})]})}),e.jsx("button",{type:"submit",className:"add-bookmark-button-2",onClick:g,children:"Add link"}),e.jsx("button",{className:"close-form-button",onClick:o=>x(),children:e.jsx("img",{src:"./assets/delete-icon.svg"})})]})}class ue extends I.Component{render(){const{bookmarkGroup:s,groupIndex:i,sensors:c,handleDragEnd:k,handleDeleteBookmarkGroup:l}=this.props,m=s.groupName&&s.groupName!==C;return e.jsx(L,{id:s.id,children:e.jsxs("div",{className:"bookmark-group-box",children:[m&&e.jsx("button",{className:"delete-bookmark-group-button",onClick:r=>l(r,i),children:e.jsx("img",{src:"./assets/delete-icon.svg",alt:"Delete Group"})}),e.jsx(re,{bookmarkGroup:s,groupIndex:i},"heading-"+s.id),e.jsx(P,{sensors:c,collisionDetection:U,onDragEnd:k,children:e.jsx(_,{items:s.bookmarks.map(r=>r.id),strategy:W,children:s.bookmarks.map((r,p)=>e.jsx(L,{id:r.id,children:e.jsx(ie,{bookmark:r,bookmarkIndex:p,groupIndex:i},r.id)},r.id))})}),m&&e.jsx(ce,{groupIndex:i})]})},s.id)}}const me=({onLoadBookmarks:t,onExportBookmarks:s,onLogin:i})=>e.jsxs("div",{className:"top-banner",children:[e.jsx("div",{className:"logo-container",children:e.jsx("div",{className:"logo-text",children:"Mindful"})}),e.jsxs("div",{className:"icon-container",children:[e.jsx("button",{onClick:t,className:"icon-button",title:"Load Bookmarks",children:e.jsx("i",{className:"fas fa-upload"})}),e.jsx("button",{onClick:s,className:"icon-button",title:"Export Bookmarks",children:e.jsx("i",{className:"fas fa-download"})}),e.jsx("button",{onClick:i,className:"icon-button",title:"Login",children:e.jsx("i",{className:"fas fa-user"})})]})]}),S={ADD_EMPTY_GROUP:"add_empty_group",DELETE_GROUP:"delete_group",NONE:"none"};function ke(){const{bookmarkGroups:t,setBookmarkGroups:s}=u.useContext(B),[i,c]=u.useState(!0),k=u.useRef(null),l=V(Q(ne,{activationConstraint:{distance:8}})),m=u.useRef(S.NONE);u.useEffect(()=>{v().then(o=>{s(o),c(!1)})},[]),u.useEffect(()=>{if(i)return;t.some(a=>a.groupName===C&&a.bookmarks.length==0)||X(s)},[t,i]);async function r(o,a){window.confirm("Are you sure you want to delete the entire group "+t[a].groupName+"?")&&(m.current=S.DELETE_GROUP,await ae(a,s))}async function p(o){const{active:a,over:d}=o;if(!d||a.id===d.id)return;const n=t.find(f=>f.id===a.id),N=t.find(f=>f.id===d.id);if(n&&N){const f=t.findIndex(h=>h.id===a.id),E=t.findIndex(h=>h.id===d.id);oe(f,E,s)}else{let f=-1,E=-1,h=-1,y=-1;t.forEach((G,D)=>{const j=G.bookmarks.findIndex(w=>w.id===a.id);j!==-1&&(f=D,E=j)}),t.forEach((G,D)=>{const j=G.bookmarks.findIndex(w=>w.id===d.id);j!==-1&&(h=D,y=j)}),f!==-1&&E!==-1&&h!==-1&&y!==-1&&f===h&&te(E,y,f,h,s)}}async function b(){let o=await v();const a=JSON.stringify(o),d=new Blob([a],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(d),n.download="bookmarks.json",n.click()}async function g(o){const a=o.target.files[0],d=new FileReader;d.onload=async function(n){const N=n.target.result,f=JSON.parse(N);await se(f,s),console.log("Bookmarks saved to local storage:",f)},d.readAsText(a)}function x(){const o=document.createElement("input");o.type="file",o.addEventListener("change",g),o.click()}return u.useEffect(()=>{function o(a,d){console.log("Handling storage change"),d==="local"&&a[ee]&&v().then(s)}return chrome.storage.onChanged.addListener(o),()=>chrome.storage.onChanged.removeListener(o)},[]),u.useEffect(()=>{k.current&&m.current==S.ADD_EMPTY_GROUP&&k.current.querySelector(".editable-heading").focus()},[t]),e.jsxs("div",{children:[e.jsx(me,{onLoadBookmarks:x,onExportBookmarks:b}),e.jsx(P,{sensors:l,collisionDetection:U,onDragEnd:p,children:e.jsx(_,{items:t.map(o=>o.id),strategy:Z,children:e.jsx("div",{className:"bookmark-groups-container",children:t.map((o,a)=>e.jsx(ue,{bookmarkGroup:o,groupIndex:a,sensors:l,handleDragEnd:p,handleDeleteBookmarkGroup:r},o.id))})})})]})}z.render(e.jsx($,{children:e.jsx(ke,{})}),document.getElementById("root"));
