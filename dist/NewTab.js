import{r as c,A as N,j as t,c as C,e as R,d as D,a as S,R as v,b as G,u as A,f as O,D as P,g as _,S as U,h as I,i as L,l as y,k as T,P as F,m as K,C as M,n as H,o as J}from"./AppContext.js";function Y(n){const{bookmarkGroups:d,setBookmarkGroups:u}=c.useContext(N),[m,l]=c.useState(n.bookmark.name),[k,g]=c.useState(n.bookmark.url),x=o=>`https://www.google.com/s2/favicons?sz=16&domain=${o}`;function b(o,a,i,f){let r=f.current;r.setAttribute("contenteditable","true"),r.focus();const p=window.getSelection(),j=document.createRange();j.selectNodeContents(r),p.removeAllRanges(),p.addRange(j),r.addEventListener("keydown",function(h){h.key==="Enter"&&(h.preventDefault(),r.blur())}),r.addEventListener("blur",async h=>{const w=h.target.textContent.trim();l(w),await R(a,i,w,u),r.setAttribute("contenteditable","false")})}async function s(o,a,i){const f=d[a],r=f.bookmarks[i];window.confirm("Are you sure you want to delete the "+r.name+" bookmark from "+f.groupName+"?")&&await D(i,a,u)}const e=c.useRef(null);return t.jsxs("div",{className:"bookmark-container",children:[t.jsx("img",{className:"favicon",src:x(n.bookmark.url),alt:""}),t.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",ref:e,children:m}),t.jsx(B,{imagePath:"assets/edit-icon.svg",onClick:o=>b(o,n.groupIndex,n.bookmarkIndex,e)}),t.jsx(B,{imagePath:"assets/delete-icon.svg",onClick:o=>s(o,n.groupIndex,n.bookmarkIndex)})]},C())}function B(n){return t.jsx("button",{className:"modify-link-button",onClick:n.onClick,children:t.jsx("img",{src:n.imagePath,className:"modify-link-button-img"})})}function q(n){const{bookmarkGroups:d,setBookmarkGroups:u}=c.useContext(N),m=d[n.groupIndex],[l,k]=c.useState(!1),g=c.useRef(null);c.useEffect(()=>{if(l&&g.current){g.current.focus();const s=window.getSelection(),e=document.createRange();e.selectNodeContents(g.current),s.removeAllRanges(),s.addRange(e)}},[l]);async function x(s){k(!1);const e=s.target.textContent.trim();e?await S(n.groupIndex,e,u):s.target.textContent=m.groupName}function b(s){s.key==="Enter"?(s.preventDefault(),s.target.blur()):s.key==="Escape"&&(s.target.textContent=m.groupName,k(!1))}return t.jsx("h2",{ref:g,contentEditable:l,onBlur:x,onKeyDown:l?b:void 0,onClick:()=>k(!0),onPointerDown:s=>s.stopPropagation(),className:"editable-heading",suppressContentEditableWarning:!0,children:m.groupName})}function z({id:n,children:d}){const{attributes:u,listeners:m,setNodeRef:l,transform:k,transition:g,isDragging:x}=K({id:n}),b={transform:M.Transform.toString(k),transition:g,zIndex:x?999:void 0};return t.jsx("div",{ref:l,style:b,...u,...m,children:d})}const E={ADD_EMPTY_GROUP:"add_empty_group",DELETE_GROUP:"delete_group",NONE:"none"};function W(){const{bookmarkGroups:n,setBookmarkGroups:d}=c.useContext(N),u=c.useRef(null),m=A(O(F,{activationConstraint:{distance:8}})),l=c.useRef(E.NONE);async function k(e,o){window.confirm("Are you sure you want to delete the entire group "+n[o].groupName+"?")&&(l.current=E.DELETE_GROUP,await H(o,d))}async function g(e){const{active:o,over:a}=e;if(!a||o.id===a.id)return;const i=n.findIndex(r=>r.id===o.id),f=n.findIndex(r=>r.id===a.id);T(i,f,d)}async function x(){let e=await y();const o=JSON.stringify(e),a=new Blob([o],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download="bookmarks.json",i.click()}async function b(e){const o=e.target.files[0],a=new FileReader;a.onload=async function(i){const f=i.target.result,r=JSON.parse(f);await J(r,d),console.log("Bookmarks saved to local storage:",r)},a.readAsText(o)}function s(){const e=document.createElement("input");e.type="file",e.addEventListener("change",b),e.click()}return c.useEffect(()=>{function e(o,a){console.log("Handling storage change"),a==="local"&&o[L]&&y().then(d)}return chrome.storage.onChanged.addListener(e),()=>chrome.storage.onChanged.removeListener(e)},[]),c.useEffect(()=>{u.current&&l.current==E.ADD_EMPTY_GROUP&&u.current.querySelector(".editable-heading").focus()},[n]),t.jsxs("div",{children:[t.jsxs("div",{className:"export-bookmarks-button-container",children:[t.jsx("button",{className:"export-or-load-bookmarks-button",onClick:x,children:"Export Bookmarks"}),t.jsx("button",{className:"export-or-load-bookmarks-button",onClick:s,children:"Load Bookmarks"})]}),t.jsx(P,{sensors:m,collisionDetection:_,onDragEnd:g,children:t.jsx(U,{items:n.map(e=>e.id),strategy:I,children:t.jsx("div",{className:"bookmark-groups-container",children:n.map((e,o)=>t.jsx(z,{id:e.id,children:t.jsxs("div",{className:"bookmark-group-box",children:[t.jsx("button",{className:"delete-bookmark-group-button",onClick:a=>k(a,o),children:t.jsx("img",{src:"./assets/delete-icon.svg"})}),t.jsx(q,{bookmarkGroup:e,groupIndex:o},"heading-"+e.id),e.bookmarks.map((a,i)=>t.jsx(Y,{bookmark:a,bookmarkIndex:i,groupIndex:o},a.id))]})},e.id))})})})]})}v.render(t.jsx(G,{children:t.jsx(W,{})}),document.getElementById("root"));
