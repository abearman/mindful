import{r as c,A as j,j as o,c as w,e as C,d as S,a as D,R,b as G,u as A,f as O,D as P,g as _,S as U,h as L,i as T,l as v,k as I,P as F,m as M,C as H,n as J,o as K}from"./AppContext.js";function Y(n){const{bookmarkGroups:i,setBookmarkGroups:l}=c.useContext(j),[m,d]=c.useState(n.bookmark.name),[k,g]=c.useState(n.bookmark.url),f=t=>`https://www.google.com/s2/favicons?sz=16&domain=${t}`;function b(t,a,r,u){let s=u.current;s.setAttribute("contenteditable","true"),s.focus();const p=window.getSelection(),B=document.createRange();B.selectNodeContents(s),p.removeAllRanges(),p.addRange(B),s.addEventListener("keydown",function(x){x.key==="Enter"&&(x.preventDefault(),s.blur())}),s.addEventListener("blur",async x=>{const N=x.target.textContent.trim();d(N),await C(a,r,N,l),s.setAttribute("contenteditable","false")})}async function h(t,a,r){const u=i[a],s=u.bookmarks[r];window.confirm("Are you sure you want to delete the "+s.name+" bookmark from "+u.groupName+"?")&&await S(r,a,l)}const e=c.useRef(null);return o.jsxs("div",{className:"bookmark-container",children:[o.jsx("img",{className:"favicon",src:f(n.bookmark.url),alt:""}),o.jsx("a",{href:k,target:"_blank",rel:"noopener noreferrer",ref:e,children:m}),o.jsx(y,{imagePath:"assets/edit-icon.svg",onClick:t=>b(t,n.groupIndex,n.bookmarkIndex,e)}),o.jsx(y,{imagePath:"assets/delete-icon.svg",onClick:t=>h(t,n.groupIndex,n.bookmarkIndex)})]},w())}function y(n){return o.jsx("button",{className:"modify-link-button",onClick:n.onClick,children:o.jsx("img",{src:n.imagePath,className:"modify-link-button-img"})})}function q(n){const{bookmarkGroups:i,setBookmarkGroups:l}=c.useContext(j),m=i[n.groupIndex];async function d(k){const g=k.target.textContent.trim();await D(n.groupIndex,g,l)}return o.jsx("h2",{contentEditable:!0,onBlur:d,className:"editable-heading",suppressContentEditableWarning:!0,children:m.groupName})}function z({id:n,children:i}){const{attributes:l,listeners:m,setNodeRef:d,transform:k,transition:g,isDragging:f}=M({id:n}),b={transform:H.Transform.toString(k),transition:g,zIndex:f?999:void 0};return o.jsx("div",{ref:d,style:b,...l,...m,children:i})}const E={ADD_EMPTY_GROUP:"add_empty_group",DELETE_GROUP:"delete_group",NONE:"none"};function W(){const{bookmarkGroups:n,setBookmarkGroups:i}=c.useContext(j),l=c.useRef(null),m=A(O(F)),d=c.useRef(E.NONE);async function k(e,t){window.confirm("Are you sure you want to delete the entire group "+n[t].groupName+"?")&&(d.current=E.DELETE_GROUP,await J(t,i))}async function g(e){const{active:t,over:a}=e;if(!a||t.id===a.id)return;const r=n.findIndex(s=>s.id===t.id),u=n.findIndex(s=>s.id===a.id);I(r,u,i)}async function f(){let e=await v();const t=JSON.stringify(e),a=new Blob([t],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download="bookmarks.json",r.click()}async function b(e){const t=e.target.files[0],a=new FileReader;a.onload=async function(r){const u=r.target.result,s=JSON.parse(u);await K(s,i),console.log("Bookmarks saved to local storage:",s)},a.readAsText(t)}function h(){const e=document.createElement("input");e.type="file",e.addEventListener("change",b),e.click()}return c.useEffect(()=>{function e(t,a){console.log("Handling storage change"),a==="local"&&t[T]&&v().then(i)}return chrome.storage.onChanged.addListener(e),()=>chrome.storage.onChanged.removeListener(e)},[]),c.useEffect(()=>{l.current&&d.current==E.ADD_EMPTY_GROUP&&l.current.querySelector(".editable-heading").focus()},[n]),o.jsxs("div",{children:[o.jsxs("div",{className:"export-bookmarks-button-container",children:[o.jsx("button",{className:"export-or-load-bookmarks-button",onClick:f,children:"Export Bookmarks"}),o.jsx("button",{className:"export-or-load-bookmarks-button",onClick:h,children:"Load Bookmarks"})]}),o.jsx(P,{sensors:m,collisionDetection:_,onDragEnd:g,children:o.jsx(U,{items:n.map(e=>e.id),strategy:L,children:o.jsx("div",{className:"bookmark-groups-container",children:n.map((e,t)=>o.jsx(z,{id:e.id,children:o.jsxs("div",{className:"bookmark-group-box",children:[o.jsx("button",{className:"delete-bookmark-group-button",onClick:a=>k(a,t),children:o.jsx("img",{src:"./assets/delete-icon.svg"})}),o.jsx(q,{bookmarkGroup:e,groupIndex:t},"heading-"+e.id),e.bookmarks.map((a,r)=>o.jsx(Y,{bookmark:a,bookmarkIndex:r,groupIndex:t},a.id))]})},e.id))})})})]})}R.render(o.jsx(G,{children:o.jsx(W,{})}),document.getElementById("root"));
