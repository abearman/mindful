import{u as O,C as T,j as e,r as l,A as j,E as y,e as F,c as K,a as M,d as q,R as I,U as H,b as Y,s as J,l as C,D as P,f as U,S as _,v as W,g as z,h as $,i as V,k as Q,m as X,n as Z,o as ee,p as oe,q as te,P as ne,t as ae,w as re}from"./AppContext.js";function A({id:t,children:r}){const{attributes:u,listeners:i,setNodeRef:m,transform:c,transition:k,isDragging:s}=O({id:t}),p={transform:T.Transform.toString(c),transition:k,zIndex:s?999:void 0};return e.jsx("div",{ref:m,style:p,...u,...i,children:r})}const S="Enter group name";function se(t){const{bookmarkGroups:r,setBookmarkGroups:u}=l.useContext(j),{bookmarkGroup:i,groupIndex:m}=t,c=i&&i.groupName&&i.groupName!==y,[k,s]=l.useState(!1),[p,b]=l.useState(!c),g=l.useRef(null);l.useEffect(()=>{k&&g.current&&g.current.focus()},[k]);async function x(n){s(!1);const E=n.target.textContent.trim();E===""?(g.current.textContent=c?i.groupName:S,i.groupName=y,b(!c)):(b(!1),await F(m,E,u))}function o(n){n.key==="Enter"?(n.preventDefault(),n.target.blur()):n.key==="Escape"&&(n.target.textContent=c?i.groupName:S,b(!c),s(!1))}function a(n){b(n.target.textContent.trim()==="")}const d=()=>{g.current&&p&&(g.current.textContent=""),s(!0)};return e.jsx("h2",{ref:g,contentEditable:k,onBlur:x,onKeyDown:k?o:void 0,onInput:k?a:void 0,onClick:d,onPointerDown:n=>n.stopPropagation(),className:`editable-heading ${p?"placeholder-text":""}`,suppressContentEditableWarning:!0,children:c?i.groupName:S})}function ie(t){const{bookmarkGroups:r,setBookmarkGroups:u}=l.useContext(j),[i,m]=l.useState(t.bookmark.name),[c,k]=l.useState(t.bookmark.url),s=x=>`https://www.google.com/s2/favicons?sz=16&domain=${x}`;function p(x,o,a,d){let n=d.current;n.setAttribute("contenteditable","true"),n.focus();const E=window.getSelection(),f=document.createRange();f.selectNodeContents(n),E.removeAllRanges(),E.addRange(f),n.addEventListener("keydown",function(N){N.key==="Enter"&&(N.preventDefault(),n.blur())}),n.addEventListener("blur",async N=>{const h=N.target.textContent.trim();m(h),await M(o,a,h,u),n.setAttribute("contenteditable","false")})}async function b(x,o,a){const d=r[o],n=d.bookmarks[a];window.confirm("Are you sure you want to delete the "+n.name+" bookmark from "+d.groupName+"?")&&await q(a,o,u)}const g=l.useRef(null);return e.jsxs("div",{className:"bookmark-container",children:[e.jsx("img",{className:"favicon",src:s(t.bookmark.url),alt:""}),e.jsx("a",{href:c,target:"_blank",rel:"noopener noreferrer",ref:g,children:i}),e.jsx(L,{imagePath:"assets/edit-icon.svg",onClick:x=>p(x,t.groupIndex,t.bookmarkIndex,g)}),e.jsx(L,{imagePath:"assets/delete-icon.svg",onClick:x=>b(x,t.groupIndex,t.bookmarkIndex)})]},K())}function L(t){return e.jsx("button",{className:"modify-link-button",onClick:t.onClick,children:e.jsx("img",{src:t.imagePath,className:"modify-link-button-img"})})}function ce(t){const{bookmarkGroups:r,setBookmarkGroups:u}=l.useContext(j),[i,m]=l.useState(!1),c=r[t.groupIndex].groupName;function k(s){m(!0)}return e.jsx("div",{className:"add-link-inline-container",children:i?e.jsx(le,{groupName:c,setLinkBeingEdited:m}):e.jsx(de,{onClick:k})})}function de(t){return e.jsx("div",{children:e.jsx("button",{className:"add-bookmark-button-1",onClick:t.onClick,children:"+ Add Link"})})}function le(t){const{bookmarkGroups:r,setBookmarkGroups:u}=l.useContext(j),[i,m]=I.useState(""),[c,k]=I.useState("");function s(o){m(o.target.value)}function p(o){k(o.target.value)}function b(o){o.key==="Enter"&&(o.preventDefault(),g(o))}async function g(o){o.preventDefault();const a=Y(c);console.log("props.groupName: ",t.groupName),J(i,a,t.groupName,u),u(await C()),m(""),k(""),t.setLinkBeingEdited(!1)}function x(o){t.setLinkBeingEdited(!1)}return e.jsxs("div",{className:"create-new-bookmark-component",children:[e.jsx("div",{className:"form-container",children:e.jsxs("form",{onKeyDown:b,children:[e.jsx("input",{type:"text",placeholder:"Enter a bookmark name ...",autoFocus:!0,value:i,onChange:s,required:!0}),e.jsx("input",{type:"text",placeholder:"Enter a bookmark URL ...",value:c,onChange:p,pattern:H,required:!0})]})}),e.jsx("button",{type:"submit",className:"add-bookmark-button-2",onClick:g,children:"Add Bookmark"}),e.jsx("button",{className:"close-form-button",onClick:o=>x(),children:e.jsx("img",{src:"./assets/delete-icon.svg"})})]})}class ue extends I.Component{render(){const{bookmarkGroup:r,groupIndex:u,sensors:i,handleDragEnd:m,handleDeleteBookmarkGroup:c}=this.props,k=r.groupName&&r.groupName!==y;return e.jsx(A,{id:r.id,children:e.jsxs("div",{className:"bookmark-group-box",children:[e.jsx("button",{className:"delete-bookmark-group-button",onClick:s=>c(s,u),children:e.jsx("img",{src:"./assets/delete-icon.svg",alt:"Delete Group"})}),e.jsx(se,{bookmarkGroup:r,groupIndex:u},"heading-"+r.id),e.jsx(P,{sensors:i,collisionDetection:U,onDragEnd:m,children:e.jsx(_,{items:r.bookmarks.map(s=>s.id),strategy:W,children:r.bookmarks.map((s,p)=>e.jsx(A,{id:s.id,children:e.jsx(ie,{bookmark:s,bookmarkIndex:p,groupIndex:u},s.id)},s.id))})}),k&&e.jsx(ce,{groupIndex:u})]})},r.id)}}const R={ADD_EMPTY_GROUP:"add_empty_group",DELETE_GROUP:"delete_group",NONE:"none"};function ke(){const{bookmarkGroups:t,setBookmarkGroups:r}=l.useContext(j),[u,i]=l.useState(!0),m=l.useRef(null),c=V(Q(ne,{activationConstraint:{distance:8}})),k=l.useRef(R.NONE);l.useEffect(()=>{C().then(o=>{r(o),i(!1)})},[]),l.useEffect(()=>{if(u)return;t.some(a=>a.groupName===y&&a.bookmarks.length==0)||X(r)},[t,u]);async function s(o,a){window.confirm("Are you sure you want to delete the entire group "+t[a].groupName+"?")&&(k.current=R.DELETE_GROUP,await ae(a,r))}async function p(o){const{active:a,over:d}=o;if(!d||a.id===d.id)return;const n=t.find(f=>f.id===a.id),E=t.find(f=>f.id===d.id);if(n&&E){const f=t.findIndex(h=>h.id===a.id),N=t.findIndex(h=>h.id===d.id);oe(f,N,r)}else{let f=-1,N=-1,h=-1,v=-1;t.forEach((G,D)=>{const B=G.bookmarks.findIndex(w=>w.id===a.id);B!==-1&&(f=D,N=B)}),t.forEach((G,D)=>{const B=G.bookmarks.findIndex(w=>w.id===d.id);B!==-1&&(h=D,v=B)}),f!==-1&&N!==-1&&h!==-1&&v!==-1&&f===h&&te(N,v,f,h,r)}}async function b(){let o=await C();const a=JSON.stringify(o),d=new Blob([a],{type:"application/json"}),n=document.createElement("a");n.href=URL.createObjectURL(d),n.download="bookmarks.json",n.click()}async function g(o){const a=o.target.files[0],d=new FileReader;d.onload=async function(n){const E=n.target.result,f=JSON.parse(E);await re(f,r),console.log("Bookmarks saved to local storage:",f)},d.readAsText(a)}function x(){const o=document.createElement("input");o.type="file",o.addEventListener("change",g),o.click()}return l.useEffect(()=>{function o(a,d){console.log("Handling storage change"),d==="local"&&a[ee]&&C().then(r)}return chrome.storage.onChanged.addListener(o),()=>chrome.storage.onChanged.removeListener(o)},[]),l.useEffect(()=>{m.current&&k.current==R.ADD_EMPTY_GROUP&&m.current.querySelector(".editable-heading").focus()},[t]),e.jsxs("div",{children:[e.jsxs("div",{className:"export-bookmarks-button-container",children:[e.jsx("button",{className:"export-or-load-bookmarks-button",onClick:b,children:"Export Bookmarks"}),e.jsx("button",{className:"export-or-load-bookmarks-button",onClick:x,children:"Load Bookmarks"})]}),e.jsx(P,{sensors:c,collisionDetection:U,onDragEnd:p,children:e.jsx(_,{items:t.map(o=>o.id),strategy:Z,children:e.jsx("div",{className:"bookmark-groups-container",children:t.map((o,a)=>e.jsx(ue,{bookmarkGroup:o,groupIndex:a,sensors:c,handleDragEnd:p,handleDeleteBookmarkGroup:s},o.id))})})})]})}z.render(e.jsx($,{children:e.jsx(ke,{})}),document.getElementById("root"));
